# ~/.bashrc: executed by bash(1) for non-login shells.
#
# this gets sourced by all interactive shells

# see /usr/share/doc/bash/examples/startup-files for examples

## source global defaults
if [[ -f /etc/bashrc ]]
then
    . /etc/bashrc
fi

#> If running interactively ...
if [[ $PS1 ]]
then
    #> turn off terminal driver flow control so C-s and C-q works
    #> and don't interfere with vim
    stty -ixon -ixoff

    # This is MacOS foo
    if [[ -f /usr/local/etc/bash_completion ]]
    then
        . /usr/local/etc/bash_completion
    fi

    #> source private libraries
    for lib in hosts prompt
    do
        [[ -f ~/dotfiles/bash/$lib ]] && source ~/dotfiles/bash/$lib
    done
    unset lib

    if [[ -f /usr/bin/aws_completer ]]
    then
        complete -C '/usr/bin/aws_completer' aws
    fi

    #> aliases

    # personal preferences
    alias cp='cp -i'
    alias mv='mv -i'
    alias rm='rm -I'
    alias ff='firefox'
    alias lo='libreoffice'
    alias powertop='sudo powertop'

    alias docker='sudo docker'

    # If this is not installed try
    #
    # pip install --user howdoi
    if $(command -v howdoi >/dev/null)
    then
        alias h='function hdi(){ howdoi $* -c -n 5; }; hdi'
    fi

    # use color ls
    alias ll='ls -h -p -l --color=auto'
    alias l.='ls -p -d --color=auto .*'
    alias ls='ls -p --color=auto'
    alias ..='cd ..'

    if [[ -f ~/.vim/gvim.sh ]]
    then
        alias g='~/.vim/gvim.sh'
    else
        alias g='/usr/bin/gvim'
    fi
    alias vimdiff='vimdiff --noplugins'

    # overrides for weird Mac env
    if [[ -n $Apple_PubSub_Socket_Render ]]
    then
        alias ll='ls -h -p -l -G'
        alias l.='ls -p -d -G .*'
        alias ls='ls -p -G'
        alias rm='rm -i'
    fi

    #>bash_completion
    if [[ -n "$BASH_COMPLETION" ]]
    then
        complete -F _root_command -o filenames s
    fi

    ## Shell options

    # Ensured hashed commands exist, else fallback to path search
    shopt -s checkhash

    # Auto update updates LINES and COLUMNS on change in window size
    shopt -s checkwinsize

    # Convert multi-line command to single line commands in history
    shopt -s cmdhist

    # Append history to existing hist file on exit
    shopt -s histappend

    # Allow re-edit of failed history substitution.
    shopt -s histreedit

    # Verify hist substitution before executing
    shopt -s histverify

    # Make # on command line behave like a comment char in scripts
    shopt -s interactive_comments

    # Don't attempt completion if the command line is empty
    shopt -s no_empty_cmd_completion

    # Filename expansion is case-insensitive
    shopt -s nocaseglob

    # Enable programmable completion facilities
    shopt -s progcomp

    # Expand vars and parameters in prompt strings
    shopt -s promptvars

    # Turn off the following unintuitive options

    # Filename globs that match nothing expand to themselves
    shopt -u nullglob

    # Don't check PATH when looking for args to the 'source' command
    shopt -u sourcepath

    # Don't sent SIGHUP to all jobs when a interactive login shell exits
    shopt -u huponexit

    #> Don't let `cd' fallback to variable lookup using the arg as name
    shopt -u cdable_vars

    #> Don't auto correct minor spelling errors
    shopt -u cdspell

    # Don't allow dotfiles in the results of path-name expansion
    shopt -u dotglob

    # Don't same multi-line commands to history literally
    shopt -u lithist

    # Don't check mail
    shopt -u mailwarn

    if type direnv 2>/dev/null
    then
        eval "$(direnv hook bash)"
    fi
fi
